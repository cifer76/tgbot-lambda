package main

import (
	"context"
	"crypto/tls"
	"fmt"
	"log"
	"net/http"
	"os"
	"time"

	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
	opensearch "github.com/opensearch-project/opensearch-go"
)

var bot *tgbotapi.BotAPI

func main() {
	// initialize tgbot
	botToken := os.Getenv("BOT_TOKEN")
	if botToken == "" {
		log.Fatalln("environment BOT_TOKEN empty!")
	}
	botDebug := os.Getenv("BOT_DEBUG")

	var err error
	bot, err = tgbotapi.NewBotAPI(botToken)
	if err != nil {
		log.Panic(err)
	}
	bot.Debug = botDebug == "true"

	// initialize opensearch client
	server := os.Getenv("OPENSEARCH_SERVER")
	if server == "" {
		log.Fatalln("environment OPENSEARCH_SERVER empty!")
	}

	// Initialize the client with SSL/TLS enabled.
	opensvc, err = opensearch.NewClient(opensearch.Config{
		Transport: &http.Transport{
			TLSClientConfig: &tls.Config{InsecureSkipVerify: true},
		},
		Addresses: []string{server},
	})
	if err != nil {
		log.Panic("cannot initialize", err)
	}

	groups := []string{
		/*
					"haoyybots",
					"cnsex8",
					"bodu365bocai",
					"binancechinese",
					"yxbjx",
					"baoaa",
					"tg128",
					"quanxapp",
					"dny_pt",
					"shadowrocketapp",
					"languagebattle",
					"tronfi_cn",
					"onlineappleusergroup",
					"three001",
					"hao123cn",
					"ebgreencard",
					"daststoken",
					"sou360",
					"loveapps",
					"hz_tl",
					"zrucaran420",
					"homenet6",
					"cryptobartw",
					"overseaschinese",
					"discussimmigration",
					"tg148",
					"xinyimin",
					"google_drive",
					"anwangtianping",
					"secretofnude",
					"heishi",
					"okexgroup_chinese",
					"boss_bamboo_118",
					"thelunarcity",
					"oneglobe2020",
					"bdsm_together",
					"sexchina2020",
					"hkersgym",
					"cryptocom_chinese",
					"tvbox002",
					"dongguanmassage",
					"emacs_zh",
					"zywssjqr",
					"aaa_club",
				"seventyto00hkchatroom",
				"avalanche_zh",
				"hot_pepper_official",
				"tos_unofficial",
				"nicegram_cn",
				"ps4gta5grouphk",
				"yitongjianghu",
				"stateanddemocracy",
				"duanzigame",
				"homehkstock",
				"guangzhou8800",
				"yixingzuche",
				"housamo_nsfw",
				"pttlive",
				"ch_groups_bot",
				"gentoo_zh_offtopic",
				"quantumultapp",
				"gephusers",
				"qunzhutuiguangok",
				"hkhistorygp",
				"bdsm_dictate",
				"xyft668",
				"wanneng_sp",
				"bnochatoooo",
				"hao123fuck",
				"bnouk",
				"taiwannumberone",
				"runtogetherhkersshama",
				"club520",
				"howlbywolfshk",
				"forexgoldoil",
				"offerplans",
				"linguisticacademy",
				"aceexchange",
				"reiwakajin",
				"housamo",
				"androidcommunicationgroup",
				"vpnchina2",
				"bc8090",
				"nightowlclub",
				"kr123",
				"nucypherch",
				"game_gamez",
				"tgmusic123",
				"chinawzry",
				"yijia888",
				"galgamer",
				"just_cn2",
				"maxexchange",
				"dingpp",
				"ysitd",
				"satoshitalk",
				"demoforum2412",
				"playstation4tw",
				"dsechatroom",
				"bdsm_together_1",
				"ldcp9977",
				"jfichina",
				"bcfbar",
				"keyboard_cn",
				"nintendo_zh_g",
				"axmassage",
				"learn_ja_group",
				"tuenmunparkhc",
				"cnlottery_chat",
				"a1massage",
				"google_win",
				"ripplefans",
				"financial_ghostgroup",
				"onmoe",
				"pan_icu",
				"mobiletw",
				"chinahk123",
				"arcs_arx_cn",
				"everyonelifeclub",
				"qunzhuduoduo",
				"typechat",
				"zxp99",
				"funlife888",
				"monsterhuntertw",
				"tgzhcn",
				"nintendoswitch_cn",
				"beijingcrypto",
				"ikhihala",
				"movepl",
				"kuaishoutg",
				"gxlsj",
				"marginalizedpersonsclub",
				"mosucd",
				"dsebio",
				"du_shu",
				"mcochwl",
				"liujiyuan",
				"maticnetwork_china",
				"thousandblockchain",
				"lifeanatech",
				"oktwnetwork",
				"bitdo_asia",
				"ethgroup",
				"wstudy",
				"beijing2019ncov",
				"femaledogs",
				"iotamoon",
				"dlgta",
				"ontologynetworkcn",
				"rakutenmonkeys",
				"us1688",
				"peacearth_chat",
				"kucoin_exchange_cn",
				"philosophystudentshk",
				"tdmtground",
				"fightsari",
				"beancount_zh",
				"zhonglelequn",
				"xiaohao2018",
				"poolinwalletcn",
				"loverime",
				"longzihu",
				"deletedfinancegroup",
				"harbininstituteoftechnology",
				"fiamthu1",
				"javascripttw",
				"shuiqianinfo",
				"phtelegram",
				"lohasisland",
				"hearts_of_iron4",
				"nihongolearn",
				"smarthomehk",
				"ico_info",
				"seventogether",
				"yueguangqun",
				"freedom326",
				"truetodamoon",
				"dalutui",
				"wikinews_zh_n",
				"dianbotai",
				"cypherium_asia",
				"adguard_cn",
				"tmlungmun",
				"hkduker",
			"dfsqzxq0",
			"marriage_equality",
			"eosvote",
			"qqq_poseidon_zh",
			"wink_china",
			"androiddiscuss",
			"whfyyq",
			"odustu",
			"tms_discuss",
			"konghou",
			"coinexcn",
			"dlkvpn",
			"nf_home",
			"dsechi",
			"chromebook_cn",
			"edcblockchainchina",
			"aercentet",
			"happywolffriends",
			"binancedexchangecn",
			"moli_rocks",
			"csgocn",
			"sstaprule",
			"vuejs_cn",
			"cardanochinaofficial",
			"arcblockasian",
			"fairpoker",
			"vegantaiwan",
			"hkevowners",
			"star_lamour",
			"exchangeactivities",
			"coinbaazar_china",
			"tecracoinio",
			"phoenix_tree_group",
			"ton_cn",
			"feipinpin",
			"imessageimmigrant",
			"hightabletalk",
			"it_normal_life_new",
			"ansible_tw",
			"tgmeishitansuo",
			"formosataiwan2",
			"douban_discuss",
			"readinggroup",
			"botsomething",
			"qianzheng88",
			"pinconger",
			"velaschinaofficial",
			"guanggunxiehui",
			"kotlin_cn",
			"paxfulcn",
			"dsebafs",
			"boygirlvs",
			"tlleorg",
			"sindzichat",
			"jack6618",
			"vite_zh",
			"zh_wool",
			"antims",
			"gifgroupcn",
			"zuanarena",
			"xianorg",
			"hcashfans",
			"us_society_and_politics",
			"tofuc",
			"dsegeog",
			"camove",
			"wikipedia_zh_dc",
			"dsemaths2",
			"museelogue",
			"qingquliaot",
			"racernet",
			"xdapp999",
			"moonstate",
			"iostchinese",
			"daanhsinyisongshan",
			"cnt66y",
			"youchain_en",
			"dushufenxiang_chat",
			"lkfworld",
			"kwuntonghk",
			"luckydesignerspace",
			"bethashcn1",
			"cn_hitbtc",
			"haerbinmy",
			"hkblackww",
			"chinaminerclub",
			"zhgxwh",
			"gentoowithoutjuju",
			"tgx_group",
			"ddos8uc_1",
			"wxllk80",
			"tokusatsufigure_zh",
			"haerbinxinxijiaoliu",
			"englishvivid",
			"banano_cn",
			"meomiao",
			"changweisexe",
			"hkaccstrike",
			"wenzhouren",
			"sz88888",
			"btsjys",
			"jzylab",
			"ky2021",
			"seoxuexi",
			"dsemaths1",
			"njtech",
			"newtonprojectchinese",
			"elrondnetwork_cn",
			"twamnesiawolf",
			"coinbene_cn",
			"smartsignature_io",
			"kavachinese",
			"freecoinone",
			"baidugroup",
			"homework_zh",
			"fh_chat",
			"bahamuttw",
			"newshubfw",
			"szplaygroup",
			"movie8c",
			"phbwdj",
			"wikipedia_zh_wsu",
			"googleplayparty",
			"wikipedia_yue",
			"translation_chinese_ancient",
			"balance_com",
			"wikipedia_lzh",
			"frontend_talk",
			"kyberchinese",
			"ppwingame",
			"pubglua",
			"brothersisterhk_tuenmun",
			"chineselesson",
			"dselss",
			"akinacafe",
			"sdmrr",
			"loomnetworkcn",
			"codingyourself",
			"imoexchange_china",
			"guangzhouitt",
			"coolapkxianliao",
			"fatboyfansclub",
			"neofans",
			"useless_project_discussion",
			"greenlightofficial",
			"huzhimingmeinv",
			"dsehis",
			"oax_cn",
			"irisnetworkcn",
			"yueguangqunchat",
			"cat_brigade",
			"society_and_politics",
			"antiwechat",
			"shixiong_a",
			"gifgrouptw",
			"blackholetalk",
			"greenlightchinese",
			"blockchaindatacn",
			"lingsaugai",
			"kfakame",
			"techfusionchat",
			"xianyitwn",
			"jietoutuya",
			"liuliangka1949",
			"trustwallet_cn",
			"wanjishaonvziyuanclub",
			"virmach_group",
			"feverasshole",
			"brothersisterhk_tsuenwan",
			"ssrcnr",
			"ysappa2",
			"ding_dong_ding_dong",
			"translation_taiwan",
			"coolapk_minecraftbe",
			"kure001",
			"mathshk",
			"userbottestingspam",
			"wearenoton9tkt",
			"dsechem",
			"supercarglobal_official",
			"st714",
			"qqqtoken",
			"wikipedia_zh_music",
			"bhex_chn",
			"stilnox_planet",
			"forfreenetworkgroup",
			"sexbba",
			"wikibooks_zh",
			"waltonchain_china",
			"hkindependencegp",
			"stationerylove",
			"pinetworkhelper",
			"twkbground",
			"winfast666",
			"kamarichinese",
			"ggs56g",
			"ddos8uc",
			"clovers_said",
			"weixin_yh",
		*/
		"tkt02",
		"expressnode",
		"cryptomiao",
		"fetchai_cn",
		"rnb_jb",
		"chinese_characters",
		"gansutg",
		"mklennongroup",
		"fedora_tw",
		"hxcloud",
		"xdosc",
		"bocai188",
		"kaichequn88",
		"lavatech",
		"machixofficial",
		"karochi_kelishurchi",
		"hkparliament",
		"testdasts",
		"cndogshome",
		"acg18moe",
		"antigoogle",
		"nohkip",
		"pcredivezh",
		"mycosschinese",
		"xianyitw8",
		"brothersisterfacebookclub",
		"grabluckychinese",
		"asiaedx",
		"letstalkinsql",
		"beehive_game_china",
		"japaniscool",
		"eospowcommunity",
		"singbady",
		"masschinese",
		"kickico_china",
		"bocaisj",
		"ltonetwork_cn",
		"happyjobhk",
		"macauguy",
		"brothersisterhk_yautsimmong",
		"eosjackscn",
		"dsechihis",
		"populstaycn",
		"giftochinese",
		"greenlightusa",
		"cloudcoin_china",
		"swagliver",
		"nutopiaio_cn",
		"t1b2h3t4k5",
		"kanaheiforest",
		"mithrilchat_zh",
		"amtbtn_tg_room",
		"dsels",
		"hkaa1",
		"movehk",
		"linfinitycn",
		"shadiaofriend",
		"abccexofficial_cn",
		"kb_tgdc5",
		"tiyachan",
		"fflfanfenlie",
		"teletowers",
		"eosfans",
		"ultrain_cn",
		"sm520",
		"hz_tc",
		"peacefulhk",
		"tgfxzk2",
		"hrzyq",
		"money4uoffical",
		"hkpromotion",
		"fairgameonline",
		"lifeintaiwan",
		"bandprotocolcn",
		"coinseason",
		"blockchainshanghai",
		"freechatclub",
		"guowengui17",
		"main2amoi",
		"chromawayofficial",
		"arcs_arx_cn_tw",
		"lanews2020",
		"btmfans",
		"canadatraders",
		"talknchat",
		"giftwgroup",
		"windows2okey",
		"gjcomex",
		"sw728",
		"molofficial2",
		"mimemi_cloud",
		"log_trans_hk",
		"nb250",
		"afanti001",
		"cuhkprotestorsgroup",
		"teahouse2nd",
		"greenplanetearth",
		"fangong",
		"cateringindustrystrike",
		"taipodistrictcouncilfrontline",
		"crypto_raiders_china",
		"shatinindependent",
		"neimenggutg",
		"nekopen",
		"discusscrossgfw",
		"freeislandeast",
		"coinboba",
		"antitotalism929",
		"porn580",
		"ballballgame",
		"wfpornbot",
		"haiwaipin888",
		"stickergroup",
		"zh_hookup",
		"xxdeep",
		"flbwm",
		"yuanma_66",
		"tgcar_ph",
		"jimmyguide",
		"zhenzhutiaocao",
		"bcpay",
	}

	for _, g := range groups {
		s, memberCount, err := getGroupInfo(context.Background(), g)
		if err != nil {
			continue
		}
		fmt.Printf("New group, ID: %v, name: %s, type: %s, memberCount: %d, description: %s\n", s.ID, s.Title, s.Type, memberCount, s.Description)
		opensearchWriteGroup(context.Background(), GroupRecord{
			Username:    s.UserName,
			ChatID:      s.ID,
			Title:       s.Title,
			Type:        s.Type,
			Description: s.Description,
			MemberCount: memberCount,
		})
		time.Sleep(5 * time.Second)
	}
}
